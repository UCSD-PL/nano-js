define pred vma^(x): 
  ( 
	((x l= nil) & emp) | 
          (((x |-> loc next: nxt; int start: st; int end: ed) & ((st <= ed) & (ed lt-set addrs^(nxt)))) * vma^(nxt))
  );


define set-fun addrs^(x):
  (case (x l= nil): emptyset;
  case ((x |-> loc next: nxt; int start: st; int end: ed) * true): 
   	(((singleton st) union (singleton ed)) union addrs^(nxt));
   default: emptyset
  ) ;


method vma-remove(loc x)
requires: ((vma^(x) & (addrset s= addrs^(x))) & ((x |-> int start: st; int end: ed) * true));
ensures: (vma^(ret) & (addrs^(ret) s= ((addrset setminus (singleton st)) setminus (singleton ed))));



bb loop-pre:
pre: ((vma^(x) & (addrset s= addrs^(x))) & ((x |-> int start: st; int end: ed) * true));
post: vma^(x);
{
	loc x-next := vma-remove(x);
	loc x := x-next;
}


bb loop-inductive:
pre: vma^(x);
post: vma^(x);
{
	assume (! (x l== nil));
	loc x-next := vma-remove(x);
	loc x := x-next;
}



bb loop-post:
pre: vma^(x);
post: emp;
{
	assume (x l== nil);
}
